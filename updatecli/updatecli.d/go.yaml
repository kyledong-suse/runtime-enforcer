name: Update Golang version

pipelineid: golang/version

sources:
  go:
    name: Get latest Golang version
    kind: golang

conditions:
  docker:
    name: Check Docker image tag
    kind: dockerimage
    sourceid: go
    spec:
      image: docker.io/library/golang

targets:
  gomod:
    name: 'deps(go): update Go version to {{ source "go" }}'
    sourceid: go
    kind: golang/gomod
    scmid: default
    spec:
      file: go.mod

  dockerfile:
    name: "deps(go): update Docker image tag"
    kind: dockerfile
    sourceid: go
    scmid: default
    spec:
      files:
        - package/Dockerfile.operator
        - package/Dockerfile.agent
      instruction:
        keyword: FROM
        matcher: docker.io/library/golang

  pre-commit-yaml:
    name: 'deps(go): update pre-commit Go version to {{ source "go" }}'
    sourceid: go
    kind: yaml
    scmid: default
    spec:
      file: .pre-commit-config.yaml
      key: $.repos[0].hooks[0].language_version

actions:
  default:
    title: 'deps(go): update Go to {{ source "go" }} version'
    kind: github/pullrequest
    scmid: default
    spec:
      automerge: false
      mergemethod: squash
      description: |
        Automatic Golang version {{ source "go" }} update.
        This PR has been created by the automation used to automatically update the Golang version in the runtime-enforcer project
        REMEMBER IF YOU WANT TO MERGE IN A SINGLE COMMIT CHANGES AND VERSION BUMP, YOU MUST SQUASH THE COMMIT BEFORE MERGING THIS PR!
      draft: false
      labels:
        - "chore"
        - "dependencies"

scms:
  default:
    kind: github
    spec:
      user: "{{ .github.author }}"
      email: "{{ .github.email }}"
      owner: "{{ requiredEnv .github.owner }}"
      repository: "runtime-enforcer"
      token: "{{ requiredEnv .github.token }}"
      username: "{{ requiredEnv .github.user }}"
      branch: "{{ .github.branch }}"
      commitusingapi: true
      commitmessage:
        type: "chore"
        scope: deps
        title: "update Golang version"
        hidecredit: true
        footers: "Signed-off-by: RuntimeEnforcer bot <runtime-enforcer-bot@users.noreply.github.com>"
